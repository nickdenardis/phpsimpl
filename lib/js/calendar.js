/*Copyright Mihai Bazon, 2002-2005  |  www.bazon.net/mishoo
http://www.dynarch.com/projects/calendar
This script is distributed under the GNU Lesser General Public License.
Read the entire license text here: http://www.gnu.org/licenses/lgpl.html */
Calendar=function(a,b,c,d){this.activeDiv=null;this.currentDateEl=null;this.getDateStatus=null;this.getDateToolTip=null;this.getDateText=null;this.timeout=null;this.onSelected=c||null;this.onClose=d||null;this.dragging=false;this.hidden=false;this.minYear=1970;this.maxYear=2050;this.dateFormat=Calendar._TT["DEF_DATE_FORMAT"];this.ttDateFormat=Calendar._TT["TT_DATE_FORMAT"];this.isPopup=true;this.weekNumbers=true;this.firstDayOfWeek=typeof a=="number"?a:Calendar._FD;this.showsOtherMonths=false;this.dateStr=b;this.ar_days=null;this.showsTime=false;this.time24=true;this.yearStep=2;this.hiliteToday=true;this.multiple=null;this.table=null;this.element=null;this.tbody=null;this.firstdayname=null;this.monthsCombo=null;this.yearsCombo=null;this.hilitedMonth=null;this.activeMonth=null;this.hilitedYear=null;this.activeYear=null;this.dateClicked=false;if(typeof Calendar._SDN=="undefined"){if(typeof Calendar._SDN_len=="undefined"){Calendar._SDN_len=3}var e=new Array();for(var i=8;i>0;){e[--i]=Calendar._DN[i].substr(0,Calendar._SDN_len)}Calendar._SDN=e;if(typeof Calendar._SMN_len=="undefined"){Calendar._SMN_len=3}e=new Array();for(var i=12;i>0;){e[--i]=Calendar._MN[i].substr(0,Calendar._SMN_len)}Calendar._SMN=e}};Calendar._C=null;Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));Calendar.is_ie5=(Calendar.is_ie&&/msie 5\.0/i.test(navigator.userAgent));Calendar.is_ie7=(Calendar.is_ie&&/msie 7\.0/i.test(navigator.userAgent));Calendar.is_opera=/opera/i.test(navigator.userAgent);Calendar.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);Calendar.getAbsolutePos=function(a){var b=0,c=0;var d=/^div$/i.test(a.tagName);if(d&&a.scrollLeft){b=a.scrollLeft}if(d&&a.scrollTop){c=a.scrollTop}var r={x:a.offsetLeft-b,y:a.offsetTop-c};if(a.offsetParent){var e=this.getAbsolutePos(a.offsetParent);r.x+=e.x;r.y+=e.y}return r};Calendar.isRelated=function(a,b){var c=b.relatedTarget;if(!c){var d=b.type;if(d=="mouseover"){c=b.fromElement}else{if(d=="mouseout"){c=b.toElement}}}while(c){if(c==a){return true}c=c.parentNode}return false};Calendar.removeClass=function(a,b){if(!(a&&a.className)){return}var c=a.className.split(" ");var d=new Array();for(var i=c.length;i>0;){if(c[--i]!=b){d[d.length]=c[i]}}a.className=d.join(" ")};Calendar.addClass=function(a,b){Calendar.removeClass(a,b);a.className+=" "+b};Calendar.getElement=function(a){var f=Calendar.is_ie?window.event.srcElement:a.currentTarget;while(f.nodeType!=1||/^div$/i.test(f.tagName)){f=f.parentNode}return f};Calendar.getTargetElement=function(a){var f=Calendar.is_ie?window.event.srcElement:a.target;while(f.nodeType!=1){f=f.parentNode}return f};Calendar.stopEvent=function(a){a||(a=window.event);if(Calendar.is_ie){a.cancelBubble=true;a.returnValue=false}else{a.preventDefault();a.stopPropagation()}return false};Calendar.addEvent=function(a,b,c){if(a.attachEvent){a.attachEvent("on"+b,c)}else{if(a.addEventListener){a.addEventListener(b,c,true)}else{a["on"+b]=c}}};Calendar.removeEvent=function(a,b,c){if(a.detachEvent){a.detachEvent("on"+b,c)}else{if(a.removeEventListener){a.removeEventListener(b,c,true)}else{a["on"+b]=null}}};Calendar.createElement=function(a,b){var c=null;if(document.createElementNS){c=document.createElementNS("http://www.w3.org/1999/xhtml",a)}else{c=document.createElement(a)}if(typeof b!="undefined"){b.appendChild(c)}return c};Calendar._add_evs=function(a){with(Calendar){addEvent(a,"mouseover",dayMouseOver);addEvent(a,"mousedown",dayMouseDown);addEvent(a,"mouseout",dayMouseOut);if(is_ie){addEvent(a,"dblclick",dayMouseDblClick);a.setAttribute("unselectable",true)}}};Calendar.findMonth=function(a){if(typeof a.month!="undefined"){return a}else{if(typeof a.parentNode.month!="undefined"){return a.parentNode}}return null};Calendar.findYear=function(a){if(typeof a.year!="undefined"){return a}else{if(typeof a.parentNode.year!="undefined"){return a.parentNode}}return null};Calendar.showMonthsCombo=function(){var a=Calendar._C;if(!a){return false}var a=a;var b=a.activeDiv;var c=a.monthsCombo;if(a.hilitedMonth){Calendar.removeClass(a.hilitedMonth,"hilite")}if(a.activeMonth){Calendar.removeClass(a.activeMonth,"active")}var d=a.monthsCombo.getElementsByTagName("div")[a.date.getMonth()];Calendar.addClass(d,"active");a.activeMonth=d;var s=c.style;s.display="block";if(b.navtype<0){s.left=b.offsetLeft+"px"}else{var e=c.offsetWidth;if(typeof e=="undefined"){e=50}s.left=(b.offsetLeft+b.offsetWidth-e)+"px"}s.top=(b.offsetTop+b.offsetHeight)+"px"};Calendar.showYearsCombo=function(a){var b=Calendar._C;if(!b){return false}var b=b;var c=b.activeDiv;var d=b.yearsCombo;if(b.hilitedYear){Calendar.removeClass(b.hilitedYear,"hilite")}if(b.activeYear){Calendar.removeClass(b.activeYear,"active")}b.activeYear=null;var Y=b.date.getFullYear()+(a?1:-1);var e=d.firstChild;var f=false;for(var i=12;i>0;--i){if(Y>=b.minYear&&Y<=b.maxYear){e.innerHTML=Y;e.year=Y;e.style.display="block";f=true}else{e.style.display="none"}e=e.nextSibling;Y+=a?b.yearStep:-b.yearStep}if(f){var s=d.style;s.display="block";if(c.navtype<0){s.left=c.offsetLeft+"px"}else{var g=d.offsetWidth;if(typeof g=="undefined"){g=50}s.left=(c.offsetLeft+c.offsetWidth-g)+"px"}s.top=(c.offsetTop+c.offsetHeight)+"px"}};Calendar.tableMouseUp=function(a){var b=Calendar._C;if(!b){return false}if(b.timeout){clearTimeout(b.timeout)}var c=b.activeDiv;if(!c){return false}var d=Calendar.getTargetElement(a);a||(a=window.event);Calendar.removeClass(c,"active");if(d==c||d.parentNode==c){Calendar.cellClick(c,a)}var e=Calendar.findMonth(d);var f=null;if(e){f=new Date(b.date);if(e.month!=f.getMonth()){f.setMonth(e.month);b.setDate(f);b.dateClicked=false;b.callHandler()}}else{var g=Calendar.findYear(d);if(g){f=new Date(b.date);if(g.year!=f.getFullYear()){f.setFullYear(g.year);b.setDate(f);b.dateClicked=false;b.callHandler()}}}with(Calendar){removeEvent(document,"mouseup",tableMouseUp);removeEvent(document,"mouseover",tableMouseOver);removeEvent(document,"mousemove",tableMouseOver);b._hideCombos();_C=null;return stopEvent(a)}};Calendar.tableMouseOver=function(a){var b=Calendar._C;if(!b){return}var c=b.activeDiv;var d=Calendar.getTargetElement(a);if(d==c||d.parentNode==c){Calendar.addClass(c,"hilite active");Calendar.addClass(c.parentNode,"rowhilite")}else{if(typeof c.navtype=="undefined"||(c.navtype!=50&&(c.navtype==0||Math.abs(c.navtype)>2))){Calendar.removeClass(c,"active")}Calendar.removeClass(c,"hilite");Calendar.removeClass(c.parentNode,"rowhilite")}a||(a=window.event);if(c.navtype==50&&d!=c){var e=Calendar.getAbsolutePos(c);var w=c.offsetWidth;var x=a.clientX;var f;var g=true;if(x>e.x+w){f=x-e.x-w;g=false}else{f=e.x-x}if(f<0){f=0}var h=c._range;var i=c._current;var j=Math.floor(f/10)%h.length;for(var k=h.length;--k>=0;){if(h[k]==i){break}}while(j-->0){if(g){if(--k<0){k=h.length-1}}else{if(++k>=h.length){k=0}}}var l=h[k];c.innerHTML=l;b.onUpdateTime()}var m=Calendar.findMonth(d);if(m){if(m.month!=b.date.getMonth()){if(b.hilitedMonth){Calendar.removeClass(b.hilitedMonth,"hilite")}Calendar.addClass(m,"hilite");b.hilitedMonth=m}else{if(b.hilitedMonth){Calendar.removeClass(b.hilitedMonth,"hilite")}}}else{if(b.hilitedMonth){Calendar.removeClass(b.hilitedMonth,"hilite")}var n=Calendar.findYear(d);if(n){if(n.year!=b.date.getFullYear()){if(b.hilitedYear){Calendar.removeClass(b.hilitedYear,"hilite")}Calendar.addClass(n,"hilite");b.hilitedYear=n}else{if(b.hilitedYear){Calendar.removeClass(b.hilitedYear,"hilite")}}}else{if(b.hilitedYear){Calendar.removeClass(b.hilitedYear,"hilite")}}}return Calendar.stopEvent(a)};Calendar.tableMouseDown=function(a){if(Calendar.getTargetElement(a)==Calendar.getElement(a)){return Calendar.stopEvent(a)}};Calendar.calDragIt=function(a){var b=Calendar._C;if(!(b&&b.dragging)){return false}var c;var d;if(Calendar.is_ie){d=window.event.clientY+document.body.scrollTop;c=window.event.clientX+document.body.scrollLeft}else{c=a.pageX;d=a.pageY}b.hideShowCovered();var e=b.element.style;e.left=(c-b.xOffs)+"px";e.top=(d-b.yOffs)+"px";return Calendar.stopEvent(a)};Calendar.calDragEnd=function(a){var b=Calendar._C;if(!b){return false}b.dragging=false;with(Calendar){removeEvent(document,"mousemove",calDragIt);removeEvent(document,"mouseup",calDragEnd);tableMouseUp(a)}b.hideShowCovered()};Calendar.dayMouseDown=function(a){var b=Calendar.getElement(a);if(b.disabled){return false}var c=b.calendar;c.activeDiv=b;Calendar._C=c;if(b.navtype!=300){with(Calendar){if(b.navtype==50){b._current=b.innerHTML;addEvent(document,"mousemove",tableMouseOver)}else{addEvent(document,Calendar.is_ie5?"mousemove":"mouseover",tableMouseOver)}addClass(b,"hilite active");addEvent(document,"mouseup",tableMouseUp)}}else{if(c.isPopup){c._dragStart(a)}}if(b.navtype==-1||b.navtype==1){if(c.timeout){clearTimeout(c.timeout)}c.timeout=setTimeout("Calendar.showMonthsCombo()",250)}else{if(b.navtype==-2||b.navtype==2){if(c.timeout){clearTimeout(c.timeout)}c.timeout=setTimeout((b.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250)}else{c.timeout=null}}return Calendar.stopEvent(a)};Calendar.dayMouseDblClick=function(a){Calendar.cellClick(Calendar.getElement(a),a||window.event);if(Calendar.is_ie){document.selection.empty()}};Calendar.dayMouseOver=function(a){var b=Calendar.getElement(a);if(Calendar.isRelated(b,a)||Calendar._C||b.disabled){return false}if(b.ttip){if(b.ttip.substr(0,1)=="_"){b.ttip=b.caldate.print(b.calendar.ttDateFormat)+b.ttip.substr(1)}b.calendar.tooltips.innerHTML=b.ttip}if(b.navtype!=300){Calendar.addClass(b,"hilite");if(b.caldate){Calendar.addClass(b.parentNode,"rowhilite")}}return Calendar.stopEvent(a)};Calendar.dayMouseOut=function(a){with(Calendar){var b=getElement(a);if(isRelated(b,a)||_C||b.disabled){return false}removeClass(b,"hilite");if(b.caldate){removeClass(b.parentNode,"rowhilite")}if(b.calendar){b.calendar.tooltips.innerHTML=_TT["SEL_DATE"]}return stopEvent(a)}};Calendar.cellClick=function(a,b){var c=a.calendar;var d=false;var e=false;var f=null;if(typeof a.navtype=="undefined"){if(c.currentDateEl){Calendar.removeClass(c.currentDateEl,"selected");Calendar.addClass(a,"selected");d=(c.currentDateEl==a);if(!d){c.currentDateEl=a}}c.date.setDateOnly(a.caldate);f=c.date;var g=!(c.dateClicked=!a.otherMonth);if(!g&&!c.currentDateEl){c._toggleMultipleDate(new Date(f))}else{e=!a.disabled}if(g){c._init(c.firstDayOfWeek,f)}}else{if(a.navtype==200){Calendar.removeClass(a,"hilite");c.callCloseHandler();return}f=new Date(c.date);if(a.navtype==0){f.setDateOnly(new Date())}c.dateClicked=false;var h=f.getFullYear();var i=f.getMonth();function setMonth(m){var j=f.getDate();var k=f.getMonthDays(m);if(j>k){f.setDate(k)}f.setMonth(m)}switch(a.navtype){case 400:Calendar.removeClass(a,"hilite");var j=Calendar._TT["ABOUT"];if(typeof j!="undefined"){j+=c.showsTime?Calendar._TT["ABOUT_TIME"]:""}else{j='Help and about box text is not translated into this language.\nIf you know this language and you feel generous please update\nthe corresponding file in "lang" subdir to match calendar-en.js\nand send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\nThank you!\nhttp://dynarch.com/mishoo/calendar.epl\n'}alert(j);return;case -2:if(h>c.minYear){f.setFullYear(h-1)}break;case -1:if(i>0){setMonth(i-1)}else{if(h-->c.minYear){f.setFullYear(h);setMonth(11)}}break;case 1:if(i<11){setMonth(i+1)}else{if(h<c.maxYear){f.setFullYear(h+1);setMonth(0)}}break;case 2:if(h<c.maxYear){f.setFullYear(h+1)}break;case 100:c.setFirstDayOfWeek(a.fdow);return;case 50:var k=a._range;var l=a.innerHTML;for(var m=k.length;--m>=0;){if(k[m]==l){break}}if(b&&b.shiftKey){if(--m<0){m=k.length-1}}else{if(++m>=k.length){m=0}}var n=k[m];a.innerHTML=n;c.onUpdateTime();return;case 0:if((typeof c.getDateStatus=="function")&&c.getDateStatus(f,f.getFullYear(),f.getMonth(),f.getDate())){return false}break}if(!f.equalsTo(c.date)){c.setDate(f);e=true}else{if(a.navtype==0){e=d=true}}}if(e){b&&c.callHandler()}if(d){Calendar.removeClass(a,"hilite");b&&c.callCloseHandler()}};Calendar.prototype.create=function(a){var b=null;if(!a){b=document.getElementsByTagName("body")[0];this.isPopup=true}else{b=a;this.isPopup=false}this.date=this.dateStr?new Date(this.dateStr):new Date();var c=Calendar.createElement("table");this.table=c;c.cellSpacing=0;c.cellPadding=0;c.calendar=this;Calendar.addEvent(c,"mousedown",Calendar.tableMouseDown);var d=Calendar.createElement("div");this.element=d;d.className="calendar";if(this.isPopup){d.style.position="absolute";d.style.display="none"}d.appendChild(c);var e=Calendar.createElement("thead",c);var f=null;var g=null;var h=this;var i=function(j,k,l){f=Calendar.createElement("td",g);f.colSpan=k;f.className="button";if(l!=0&&Math.abs(l)<=2){f.className+=" nav"}Calendar._add_evs(f);f.calendar=h;f.navtype=l;f.innerHTML="<div unselectable='on'>"+j+"</div>";return f};g=Calendar.createElement("tr",e);var j=6;(this.isPopup)&&--j;(this.weekNumbers)&&++j;i("?",1,400).ttip=Calendar._TT["INFO"];this.title=i("",j,300);this.title.className="title";if(this.isPopup){this.title.ttip=Calendar._TT["DRAG_TO_MOVE"];this.title.style.cursor="move";i("&#x00d7;",1,200).ttip=Calendar._TT["CLOSE"]}g=Calendar.createElement("tr",e);g.className="headrow";this._nav_py=i("&#x00ab;",1,-2);this._nav_py.ttip=Calendar._TT["PREV_YEAR"];this._nav_pm=i("&#x2039;",1,-1);this._nav_pm.ttip=Calendar._TT["PREV_MONTH"];this._nav_now=i(Calendar._TT["TODAY"],this.weekNumbers?4:3,0);this._nav_now.ttip=Calendar._TT["GO_TODAY"];this._nav_nm=i("&#x203a;",1,1);this._nav_nm.ttip=Calendar._TT["NEXT_MONTH"];this._nav_ny=i("&#x00bb;",1,2);this._nav_ny.ttip=Calendar._TT["NEXT_YEAR"];g=Calendar.createElement("tr",e);g.className="daynames";if(this.weekNumbers){f=Calendar.createElement("td",g);f.className="name wn";f.innerHTML=Calendar._TT["WK"]}for(var k=7;k>0;--k){f=Calendar.createElement("td",g);if(!k){f.navtype=100;f.calendar=this;Calendar._add_evs(f)}}this.firstdayname=(this.weekNumbers)?g.firstChild.nextSibling:g.firstChild;this._displayWeekdays();var l=Calendar.createElement("tbody",c);this.tbody=l;for(k=6;k>0;--k){g=Calendar.createElement("tr",l);if(this.weekNumbers){f=Calendar.createElement("td",g)}for(var m=7;m>0;--m){f=Calendar.createElement("td",g);f.calendar=this;Calendar._add_evs(f)}}if(this.showsTime){g=Calendar.createElement("tr",l);g.className="time";f=Calendar.createElement("td",g);f.className="time";f.colSpan=2;f.innerHTML=Calendar._TT["TIME"]||"&nbsp;";f=Calendar.createElement("td",g);f.className="time";f.colSpan=this.weekNumbers?4:3;(function(){function makeTimePart(n,o,p,q){var r=Calendar.createElement("span",f);r.className=n;r.innerHTML=o;r.calendar=h;r.ttip=Calendar._TT["TIME_PART"];r.navtype=50;r._range=[];if(typeof p!="number"){r._range=p}else{for(var s=p;s<=q;++s){var t;if(s<10&&q>=10){t="0"+s}else{t=""+s}r._range[r._range.length]=t}}Calendar._add_evs(r);return r}var n=h.date.getHours();var o=h.date.getMinutes();var p=!h.time24;var q=(n>12);if(p&&q){n-=12}var H=makeTimePart("hour",n,p?1:0,p?12:23);var r=Calendar.createElement("span",f);r.innerHTML=":";r.className="colon";var M=makeTimePart("minute",o,0,59);var s=null;f=Calendar.createElement("td",g);f.className="time";f.colSpan=2;if(p){s=makeTimePart("ampm",q?"pm":"am",["am","pm"])}else{f.innerHTML="&nbsp;"}h.onSetTime=function(){var t,n=this.date.getHours(),o=this.date.getMinutes();if(p){t=(n>=12);if(t){n-=12}if(n==0){n=12}s.innerHTML=t?"pm":"am"}H.innerHTML=(n<10)?("0"+n):n;M.innerHTML=(o<10)?("0"+o):o};h.onUpdateTime=function(){var t=this.date;var u=parseInt(H.innerHTML,10);if(p){if(/pm/i.test(s.innerHTML)&&u<12){u+=12}else{if(/am/i.test(s.innerHTML)&&u==12){u=0}}}var v=t.getDate();var w=t.getMonth();var y=t.getFullYear();t.setHours(u);t.setMinutes(parseInt(M.innerHTML,10));t.setFullYear(y);t.setMonth(w);t.setDate(v);this.dateClicked=false;this.callHandler()}})()}else{this.onSetTime=this.onUpdateTime=function(){}}var n=Calendar.createElement("tfoot",c);g=Calendar.createElement("tr",n);g.className="footrow";f=i(Calendar._TT["SEL_DATE"],this.weekNumbers?8:7,300);f.className="ttip";if(this.isPopup){f.ttip=Calendar._TT["DRAG_TO_MOVE"];f.style.cursor="move"}this.tooltips=f;d=Calendar.createElement("div",this.element);this.monthsCombo=d;d.className="combo";for(k=0;k<Calendar._MN.length;++k){var o=Calendar.createElement("div");o.className=Calendar.is_ie?"label-IEfix":"label";o.month=k;o.innerHTML=Calendar._SMN[k];d.appendChild(o)}d=Calendar.createElement("div",this.element);this.yearsCombo=d;d.className="combo";for(k=12;k>0;--k){var p=Calendar.createElement("div");p.className=Calendar.is_ie?"label-IEfix":"label";d.appendChild(p)}this._init(this.firstDayOfWeek,this.date);b.appendChild(this.element)};Calendar._keyEvent=function(a){var b=window._dynarch_popupCalendar;if(!b||b.multiple){return false}(Calendar.is_ie)&&(a=window.event);var c=(Calendar.is_ie||a.type=="keypress"),K=a.keyCode;if(a.ctrlKey){switch(K){case 37:c&&Calendar.cellClick(b._nav_pm);break;case 38:c&&Calendar.cellClick(b._nav_py);break;case 39:c&&Calendar.cellClick(b._nav_nm);break;case 40:c&&Calendar.cellClick(b._nav_ny);break;default:return false}}else{switch(K){case 32:Calendar.cellClick(b._nav_now);break;case 27:c&&b.callCloseHandler();break;case 37:case 38:case 39:case 40:if(c){var d,x,y,e,f,g;d=K==37||K==38;g=(K==37||K==39)?1:7;function setVars(){f=b.currentDateEl;var p=f.pos;x=p&15;y=p>>4;e=b.ar_days[y][x]}setVars();function prevMonth(){var h=new Date(b.date);h.setDate(h.getDate()-g);b.setDate(h)}function nextMonth(){var h=new Date(b.date);h.setDate(h.getDate()+g);b.setDate(h)}while(1){switch(K){case 37:if(--x>=0){e=b.ar_days[y][x]}else{x=6;K=38;continue}break;case 38:if(--y>=0){e=b.ar_days[y][x]}else{prevMonth();setVars()}break;case 39:if(++x<7){e=b.ar_days[y][x]}else{x=0;K=40;continue}break;case 40:if(++y<b.ar_days.length){e=b.ar_days[y][x]}else{nextMonth();setVars()}break}break}if(e){if(!e.disabled){Calendar.cellClick(e)}else{if(d){prevMonth()}else{nextMonth()}}}}break;case 13:if(c){Calendar.cellClick(b.currentDateEl,a)}break;default:return false}}return Calendar.stopEvent(a)};Calendar.prototype._init=function(a,b){var c=new Date(),d=c.getFullYear(),e=c.getMonth(),f=c.getDate();this.table.style.visibility="hidden";var g=b.getFullYear();if(g<this.minYear){g=this.minYear;b.setFullYear(g)}else{if(g>this.maxYear){g=this.maxYear;b.setFullYear(g)}}this.firstDayOfWeek=a;this.date=new Date(b);var h=b.getMonth();var i=b.getDate();var j=b.getMonthDays();b.setDate(1);var k=(b.getDay()-this.firstDayOfWeek)%7;if(k<0){k+=7}b.setDate(-k);b.setDate(b.getDate()+1);var l=this.tbody.firstChild;var m=Calendar._SMN[h];var n=this.ar_days=new Array();var o=Calendar._TT["WEEKEND"];var p=this.multiple?(this.datesCells={}):null;for(var q=0;q<6;++q,l=l.nextSibling){var r=l.firstChild;if(this.weekNumbers){r.className="day wn";r.innerHTML=b.getWeekNumber();r=r.nextSibling}l.className="daysrow";var s=false,t,u=n[q]=[];for(var v=0;v<7;++v,r=r.nextSibling,b.setDate(t+1)){t=b.getDate();var w=b.getDay();r.className="day";r.pos=q<<4|v;u[v]=r;var x=(b.getMonth()==h);if(!x){if(this.showsOtherMonths){r.className+=" othermonth";r.otherMonth=true}else{r.className="emptycell";r.innerHTML="&nbsp;";r.disabled=true;continue}}else{r.otherMonth=false;s=true}r.disabled=false;r.innerHTML=this.getDateText?this.getDateText(b,t):t;if(p){p[b.print("%Y%m%d")]=r}if(this.getDateStatus){var y=this.getDateStatus(b,g,h,t);if(this.getDateToolTip){var z=this.getDateToolTip(b,g,h,t);if(z){r.title=z}}if(y===true){r.className+=" disabled";r.disabled=true}else{if(/disabled/i.test(y)){r.disabled=true}r.className+=" "+y}}if(!r.disabled){r.caldate=new Date(b);r.ttip="_";if(!this.multiple&&x&&t==i&&this.hiliteToday){r.className+=" selected";this.currentDateEl=r}if(b.getFullYear()==d&&b.getMonth()==e&&t==f){r.className+=" today";r.ttip+=Calendar._TT["PART_TODAY"]}if(o.indexOf(w.toString())!=-1){r.className+=r.otherMonth?" oweekend":" weekend"}}}if(!(s||this.showsOtherMonths)){l.className="emptyrow"}}this.title.innerHTML=Calendar._MN[h]+", "+g;this.onSetTime();this.table.style.visibility="visible";this._initMultipleDates()};Calendar.prototype._initMultipleDates=function(){if(this.multiple){for(var i in this.multiple){var a=this.datesCells[i];var d=this.multiple[i];if(!d){continue}if(a){a.className+=" selected"}}}};Calendar.prototype._toggleMultipleDate=function(a){if(this.multiple){var b=a.print("%Y%m%d");var c=this.datesCells[b];if(c){var d=this.multiple[b];if(!d){Calendar.addClass(c,"selected");this.multiple[b]=a}else{Calendar.removeClass(c,"selected");delete this.multiple[b]}}}};Calendar.prototype.setDateToolTipHandler=function(a){this.getDateToolTip=a};Calendar.prototype.setDate=function(a){if(!a.equalsTo(this.date)){this._init(this.firstDayOfWeek,a)}};Calendar.prototype.refresh=function(){this._init(this.firstDayOfWeek,this.date)};Calendar.prototype.setFirstDayOfWeek=function(a){this._init(a,this.date);this._displayWeekdays()};Calendar.prototype.setDateStatusHandler=Calendar.prototype.setDisabledHandler=function(a){this.getDateStatus=a};Calendar.prototype.setRange=function(a,z){this.minYear=a;this.maxYear=z};Calendar.prototype.callHandler=function(){if(this.onSelected){this.onSelected(this,this.date.print(this.dateFormat))}};Calendar.prototype.callCloseHandler=function(){if(this.onClose){this.onClose(this)}this.hideShowCovered()};Calendar.prototype.destroy=function(){var a=this.element.parentNode;a.removeChild(this.element);Calendar._C=null;window._dynarch_popupCalendar=null};Calendar.prototype.reparent=function(a){var b=this.element;b.parentNode.removeChild(b);a.appendChild(b)};Calendar._checkCalendar=function(a){var b=window._dynarch_popupCalendar;if(!b){return false}var c=Calendar.is_ie?Calendar.getElement(a):Calendar.getTargetElement(a);for(;c!=null&&c!=b.element;c=c.parentNode){}if(c==null){window._dynarch_popupCalendar.callCloseHandler();return Calendar.stopEvent(a)}};Calendar.prototype.show=function(){var a=this.table.getElementsByTagName("tr");for(var i=a.length;i>0;){var b=a[--i];Calendar.removeClass(b,"rowhilite");var c=b.getElementsByTagName("td");for(var j=c.length;j>0;){var d=c[--j];Calendar.removeClass(d,"hilite");Calendar.removeClass(d,"active")}}this.element.style.display="block";this.hidden=false;if(this.isPopup){window._dynarch_popupCalendar=this;Calendar.addEvent(document,"keydown",Calendar._keyEvent);Calendar.addEvent(document,"keypress",Calendar._keyEvent);Calendar.addEvent(document,"mousedown",Calendar._checkCalendar)}this.hideShowCovered()};Calendar.prototype.hide=function(){if(this.isPopup){Calendar.removeEvent(document,"keydown",Calendar._keyEvent);Calendar.removeEvent(document,"keypress",Calendar._keyEvent);Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar)}this.element.style.display="none";this.hidden=true;this.hideShowCovered()};Calendar.prototype.showAt=function(x,y){var s=this.element.style;s.left=x+"px";s.top=y+"px";this.show()};Calendar.prototype.showAtElement=function(a,b){var c=this;var p=Calendar.getAbsolutePos(a);if(!b||typeof b!="string"){this.showAt(p.x,p.y+a.offsetHeight);return true}function fixPosition(d){if(d.x<0){d.x=0}if(d.y<0){d.y=0}var e=document.createElement("div");var s=e.style;s.position="absolute";s.right=s.bottom=s.width=s.height="0px";document.body.appendChild(e);var f=Calendar.getAbsolutePos(e);document.body.removeChild(e);if(Calendar.is_ie7){f.y+=window.scrollY;f.x+=window.scrollX}else{if(Calendar.is_ie){f.y+=document.body.scrollTop;f.x+=document.body.scrollLeft}else{f.y+=window.scrollY;f.x+=window.scrollX}}var g=d.x+d.width-f.x;if(g>0){d.x-=g}g=d.y+d.height-f.y;if(g>0){d.y-=g}}this.element.style.display="block";Calendar.continuation_for_the_fucking_khtml_browser=function(){var w=c.element.offsetWidth;var h=c.element.offsetHeight;c.element.style.display="none";var d=b.substr(0,1);var e="l";if(b.length>1){e=b.substr(1,1)}switch(d){case "T":p.y-=h;break;case "B":p.y+=a.offsetHeight;break;case "C":p.y+=(a.offsetHeight-h)/2;break;case "t":p.y+=a.offsetHeight-h;break;case "b":break}switch(e){case "L":p.x-=w;break;case "R":p.x+=a.offsetWidth;break;case "C":p.x+=(a.offsetWidth-w)/2;break;case "l":p.x+=a.offsetWidth-w;break;case "r":break}p.width=w;p.height=h+40;c.monthsCombo.style.display="none";fixPosition(p);c.showAt(p.x,p.y)};if(Calendar.is_khtml){setTimeout("Calendar.continuation_for_the_fucking_khtml_browser()",10)}else{Calendar.continuation_for_the_fucking_khtml_browser()}};Calendar.prototype.setDateFormat=function(a){this.dateFormat=a};Calendar.prototype.setTtDateFormat=function(a){this.ttDateFormat=a};Calendar.prototype.parseDate=function(a,b){if(!b){b=this.dateFormat}this.setDate(Date.parseDate(a,b))};Calendar.prototype.hideShowCovered=function(){if(!Calendar.is_ie&&!Calendar.is_opera){return}function getVisib(a){var b=a.style.visibility;if(!b){if(document.defaultView&&typeof (document.defaultView.getComputedStyle)=="function"){if(!Calendar.is_khtml){b=document.defaultView.getComputedStyle(a,"").getPropertyValue("visibility")}else{b=""}}else{if(a.currentStyle){b=a.currentStyle.visibility}else{b=""}}}return b}var a=new Array("applet","iframe","select");var b=this.element;var p=Calendar.getAbsolutePos(b);var c=p.x;var d=b.offsetWidth+c;var e=p.y;var f=b.offsetHeight+e;for(var k=a.length;k>0;){var g=document.getElementsByTagName(a[--k]);var h=null;for(var i=g.length;i>0;){h=g[--i];p=Calendar.getAbsolutePos(h);var j=p.x;var l=h.offsetWidth+j;var m=p.y;var n=h.offsetHeight+m;if(this.hidden||(j>d)||(l<c)||(m>f)||(n<e)){if(!h.__msh_save_visibility){h.__msh_save_visibility=getVisib(h)}h.style.visibility=h.__msh_save_visibility}else{if(!h.__msh_save_visibility){h.__msh_save_visibility=getVisib(h)}h.style.visibility="hidden"}}}};Calendar.prototype._displayWeekdays=function(){var a=this.firstDayOfWeek;var b=this.firstdayname;var c=Calendar._TT["WEEKEND"];for(var i=0;i<7;++i){b.className="day name";var d=(i+a)%7;if(i){b.ttip=Calendar._TT["DAY_FIRST"].replace("%s",Calendar._DN[d]);b.navtype=100;b.calendar=this;b.fdow=d;Calendar._add_evs(b)}if(c.indexOf(d.toString())!=-1){Calendar.addClass(b,"weekend")}b.innerHTML=Calendar._SDN[(i+a)%7];b=b.nextSibling}};Calendar.prototype._hideCombos=function(){this.monthsCombo.style.display="none";this.yearsCombo.style.display="none"};Calendar.prototype._dragStart=function(a){if(this.dragging){return}this.dragging=true;var b;var c;if(Calendar.is_ie){c=window.event.clientY+document.body.scrollTop;b=window.event.clientX+document.body.scrollLeft}else{c=a.clientY+window.scrollY;b=a.clientX+window.scrollX}var d=this.element.style;this.xOffs=b-parseInt(d.left);this.yOffs=c-parseInt(d.top);with(Calendar){addEvent(document,"mousemove",calDragIt);addEvent(document,"mouseup",calDragEnd)}};Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date.parseDate=function(a,b){var c=new Date();var y=0;var m=-1;var d=0;var e=a.split(/\W+/);var f=b.match(/%./g);var i=0,j=0;var g=0;var h=0;for(i=0;i<e.length;++i){if(!e[i]){continue}switch(f[i]){case "%d":case "%e":d=parseInt(e[i],10);break;case "%m":m=parseInt(e[i],10)-1;break;case "%Y":case "%y":y=parseInt(e[i],10);(y<100)&&(y+=(y>29)?1900:2000);break;case "%b":case "%B":for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,e[i].length).toLowerCase()==e[i].toLowerCase()){m=j;break}}break;case "%H":case "%I":case "%k":case "%l":g=parseInt(e[i],10);break;case "%P":case "%p":if(/pm/i.test(e[i])&&g<12){g+=12}else{if(/am/i.test(e[i])&&g>=12){g-=12}}break;case "%M":h=parseInt(e[i],10);break}}if(isNaN(y)){y=c.getFullYear()}if(isNaN(m)){m=c.getMonth()}if(isNaN(d)){d=c.getDate()}if(isNaN(g)){g=c.getHours()}if(isNaN(h)){h=c.getMinutes()}if(y!=0&&m!=-1&&d!=0){return new Date(y,m,d,g,h,0)}y=0;m=-1;d=0;for(i=0;i<e.length;++i){if(e[i].search(/[a-zA-Z]+/)!=-1){var t=-1;for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,e[i].length).toLowerCase()==e[i].toLowerCase()){t=j;break}}if(t!=-1){if(m!=-1){d=m+1}m=t}}else{if(parseInt(e[i],10)<=12&&m==-1){m=e[i]-1}else{if(parseInt(e[i],10)>31&&y==0){y=parseInt(e[i],10);(y<100)&&(y+=(y>29)?1900:2000)}else{if(d==0){d=e[i]}}}}}if(y==0){y=c.getFullYear()}if(m!=-1&&d!=0){return new Date(y,m,d,g,h,0)}return c};Date.prototype.getMonthDays=function(a){var b=this.getFullYear();if(typeof a=="undefined"){a=this.getMonth()}if(((0==(b%4))&&((0!=(b%100))||(0==(b%400))))&&a==1){return 29}else{return Date._MD[a]}};Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var b=new Date(this.getFullYear(),0,0,0,0,0);var c=a-b;return Math.floor(c/Date.DAY)};Date.prototype.getWeekNumber=function(){var d=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var a=d.getDay();d.setDate(d.getDate()-(a+6)%7+3);var b=d.valueOf();d.setMonth(0);d.setDate(4);return Math.round((b-d.valueOf())/(7*86400000))+1};Date.prototype.equalsTo=function(a){return ((this.getFullYear()==a.getFullYear())&&(this.getMonth()==a.getMonth())&&(this.getDate()==a.getDate())&&(this.getHours()==a.getHours())&&(this.getMinutes()==a.getMinutes()))};Date.prototype.setDateOnly=function(a){var b=new Date(a);this.setDate(1);this.setFullYear(b.getFullYear());this.setMonth(b.getMonth());this.setDate(b.getDate())};Date.prototype.print=function(a){var m=this.getMonth();var d=this.getDate();var y=this.getFullYear();var b=this.getWeekNumber();var w=this.getDay();var s={};var c=this.getHours();var e=(c>=12);var f=(e)?(c-12):c;var g=this.getDayOfYear();if(f==0){f=12}var h=this.getMinutes();var i=this.getSeconds();s["%a"]=Calendar._SDN[w];s["%A"]=Calendar._DN[w];s["%b"]=Calendar._SMN[m];s["%B"]=Calendar._MN[m];s["%C"]=1+Math.floor(y/100);s["%d"]=(d<10)?("0"+d):d;s["%e"]=d;s["%H"]=(c<10)?("0"+c):c;s["%I"]=(f<10)?("0"+f):f;s["%j"]=(g<100)?((g<10)?("00"+g):("0"+g)):g;s["%k"]=c;s["%l"]=f;s["%m"]=(m<9)?("0"+(1+m)):(1+m);s["%M"]=(h<10)?("0"+h):h;s["%n"]="\n";s["%p"]=e?"PM":"AM";s["%P"]=e?"pm":"am";s["%s"]=Math.floor(this.getTime()/1000);s["%S"]=(i<10)?("0"+i):i;s["%t"]="\t";s["%U"]=s["%W"]=s["%V"]=(b<10)?("0"+b):b;s["%u"]=w+1;s["%w"]=w;s["%y"]=(""+y).substr(2,2);s["%Y"]=y;s["%%"]="%";var j=/%./g;if(!Calendar.is_ie5&&!Calendar.is_khtml){return a.replace(j,function(k){return s[k]||k})}var k=a.match(j);for(var l=0;l<k.length;l++){var n=s[k[l]];if(n){j=new RegExp(k[l],"g");a=a.replace(j,n)}}return a};Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(y){var d=new Date(this);d.__msh_oldSetFullYear(y);if(d.getMonth()!=this.getMonth()){this.setDate(28)}this.__msh_oldSetFullYear(y)};window._dynarch_popupCalendar=null;Calendar._DN=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday");Calendar._SDN=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun");Calendar._FD=0;Calendar._MN=new Array("January","February","March","April","May","June","July","August","September","October","November","December");Calendar._SMN=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");Calendar._TT={};Calendar._TT["INFO"]="About the calendar";Calendar._TT["ABOUT"]="DHTML Date/Time Selector\n(c) dynarch.com 2002-2005 / Author: Mihai Bazon\nFor latest version visit: http://www.dynarch.com/projects/calendar/\nDistributed under GNU LGPL.  See http://gnu.org/licenses/lgpl.html for details.\n\nDate selection:\n- Use the \xab, \xbb buttons to select year\n- Use the "+String.fromCharCode(8249)+", "+String.fromCharCode(8250)+" buttons to select month\n- Hold mouse button on any of the above buttons for faster selection.";Calendar._TT["ABOUT_TIME"]="\n\nTime selection:\n- Click on any of the time parts to increase it\n- or Shift-click to decrease it\n- or click and drag for faster selection.";Calendar._TT["PREV_YEAR"]="Prev. year (hold for menu)";Calendar._TT["PREV_MONTH"]="Prev. month (hold for menu)";Calendar._TT["GO_TODAY"]="Go Today";Calendar._TT["NEXT_MONTH"]="Next month (hold for menu)";Calendar._TT["NEXT_YEAR"]="Next year (hold for menu)";Calendar._TT["SEL_DATE"]="Select date";Calendar._TT["DRAG_TO_MOVE"]="Drag to move";Calendar._TT["PART_TODAY"]=" (today)";Calendar._TT["DAY_FIRST"]="Display %s first";Calendar._TT["WEEKEND"]="0,6";Calendar._TT["CLOSE"]="Close";Calendar._TT["TODAY"]="Today";Calendar._TT["TIME_PART"]="(Shift-)Click or drag to change value";Calendar._TT["DEF_DATE_FORMAT"]="%Y-%m-%d";Calendar._TT["TT_DATE_FORMAT"]="%a, %b %e";Calendar._TT["WK"]="wk";Calendar._TT["TIME"]="Time:";Calendar.setup=function(a){function param_default(b,c){if(typeof a[b]=="undefined"){a[b]=c}}param_default("inputField",null);param_default("displayArea",null);param_default("button",null);param_default("eventName","click");param_default("ifFormat","%Y/%m/%d");param_default("daFormat","%Y/%m/%d");param_default("singleClick",true);param_default("disableFunc",null);param_default("dateStatusFunc",a["disableFunc"]);param_default("dateText",null);param_default("firstDay",null);param_default("align","Br");param_default("range",[1900,2999]);param_default("weekNumbers",true);param_default("flat",null);param_default("flatCallback",null);param_default("onSelect",null);param_default("onClose",null);param_default("onUpdate",null);param_default("date",null);param_default("showsTime",false);param_default("timeFormat","24");param_default("electric",true);param_default("step",2);param_default("position",null);param_default("cache",false);param_default("showOthers",false);param_default("multiple",null);var b=["inputField","displayArea","button"];for(var i in b){if(typeof a[b[i]]=="string"){a[b[i]]=document.getElementById(a[b[i]])}}if(!(a.flat||a.multiple||a.inputField||a.displayArea||a.button)){alert("Calendar.setup:\n  Nothing to setup (no fields found).  Please check your code");return false}function onSelect(c){var p=c.params;var d=(c.dateClicked||p.electric);if(d&&p.inputField){p.inputField.value=c.date.print(p.ifFormat);if(typeof p.inputField.onchange=="function"){p.inputField.onchange()}}if(d&&p.displayArea){p.displayArea.innerHTML=c.date.print(p.daFormat)}if(d&&typeof p.onUpdate=="function"){p.onUpdate(c)}if(d&&p.flat){if(typeof p.flatCallback=="function"){p.flatCallback(c)}}if(d&&p.singleClick&&c.dateClicked){c.callCloseHandler()}}if(a.flat!=null){if(typeof a.flat=="string"){a.flat=document.getElementById(a.flat)}if(!a.flat){alert("Calendar.setup:\n  Flat specified but can't find parent.");return false}var c=new Calendar(a.firstDay,a.date,a.onSelect||onSelect);c.showsOtherMonths=a.showOthers;c.showsTime=a.showsTime;c.time24=(a.timeFormat=="24");c.params=a;c.weekNumbers=a.weekNumbers;c.setRange(a.range[0],a.range[1]);c.setDateStatusHandler(a.dateStatusFunc);c.getDateText=a.dateText;if(a.ifFormat){c.setDateFormat(a.ifFormat)}if(a.inputField&&typeof a.inputField.value=="string"){c.parseDate(a.inputField.value)}c.create(a.flat);c.show();return false}var d=a.button||a.displayArea||a.inputField;d["on"+a.eventName]=function(){var e=a.inputField||a.displayArea;var f=a.inputField?a.ifFormat:a.daFormat;var g=false;var h=window.calendar;if(e){a.date=Date.parseDate(e.value||e.innerHTML,f)}if(!(h&&a.cache)){window.calendar=h=new Calendar(a.firstDay,a.date,a.onSelect||onSelect,a.onClose||function(j){j.hide()});h.showsTime=a.showsTime;h.time24=(a.timeFormat=="24");h.weekNumbers=a.weekNumbers;g=true}else{if(a.date){h.setDate(a.date)}h.hide()}if(a.multiple){h.multiple={};for(var j=a.multiple.length;--j>=0;){var k=a.multiple[j];var l=k.print("%Y%m%d");h.multiple[l]=k}}h.showsOtherMonths=a.showOthers;h.yearStep=a.step;h.setRange(a.range[0],a.range[1]);h.params=a;h.setDateStatusHandler(a.dateStatusFunc);h.getDateText=a.dateText;h.setDateFormat(f);if(g){h.create()}h.refresh();if(!a.position){h.showAtElement(a.button||a.displayArea||a.inputField,a.align)}else{h.showAt(a.position[0],a.position[1])}return false};return c}